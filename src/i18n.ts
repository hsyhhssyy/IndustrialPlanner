import type { DeviceTypeId, EditMode } from './domain/types'

export type Language = 'zh-CN' | 'en-US'

export const LANGUAGE_OPTIONS: Array<{ value: Language; label: string }> = [
  { value: 'zh-CN', label: '中文' },
  { value: 'en-US', label: 'English' },
]

const MESSAGES: Record<Language, Record<string, string>> = {
  'zh-CN': {
    'app.title': '终末地工业系统仿真器 Stage1',
    'app.language': '语言',
    'top.start': '开始仿真',
    'top.stop': '退出仿真',
    'top.zoomHint': '缩放：{size}px',
    'top.runningHint': '仿真中：编辑动作已禁用',
    'top.editHint': '编辑态：可放置/移动/铺设/删除',
    'left.mode': '模式',
    'left.device': '设备',
    'left.group.logistics': '物流',
    'left.group.resource': '资源开采',
    'left.group.storage': '仓储存取',
    'left.group.basicProduction': '基础生产',
    'left.group.advancedManufacturing': '合成制造',
    'left.group.power': '电力',
    'left.group.functional': '功能设备',
    'left.group.combatSupport': '战斗辅助',
    'left.group.empty': '暂无设备',
    'left.logisticsSubMode': '物流子模式',
    'left.placeBelt': '放置传送带',
    'left.deleteSubMode': '删除子模式',
    'left.deleteSingle': '单格',
    'left.deleteWholeBelt': '整条传送带',
    'left.deleteAll': '删除所有内容',
    'left.deleteAllConfirm': '确认删除所有设备吗？此操作无法撤销。',
    'right.lot': '基地',
    'right.baseGroup.valley4': '四号谷地',
    'right.baseGroup.wuling': '武陵',
    'right.baseGroup.empty': '暂无基地',
    'right.basePlaceableSize': '可放置区域',
    'right.baseOuterRing': '外扩尺寸',
    'right.baseTags': '基地标签',
    'right.stats': '仓库统计',
    'right.simDebug': '仿真调试',
    'right.selected': '选中详情',
    'right.noneSelected': '未选中对象',
    'debug.expectedTps': '期望 Tick/s',
    'debug.measuredTps': '实测 Tick/s',
    'debug.simTick': '当前 Tick',
    'debug.simSeconds': '仿真秒数',
    'debug.cellSeconds': '理论单格耗时(s)',
    'debug.beltPerMin': '理论单带吞吐(/min)',
    'table.itemName': '物品名称',
    'table.producedPerMinute': '产出每分',
    'table.consumedPerMinute': '消耗每分',
    'table.currentStock': '当前库存',
    'detail.instanceId': '实例ID',
    'detail.deviceType': '建筑类型',
    'detail.rotation': '旋转角度',
    'detail.position': '位置',
    'detail.status': '状态',
    'detail.currentStatus': '当前状态',
    'detail.internalStatus': '内部状态',
    'detail.internal.noRuntime': '未进入仿真',
    'detail.internal.canAccept': '可接受物品（空槽）',
    'detail.internal.occupiedHalf': '占用中（0-0.5），进度 {progress}',
    'detail.internal.canTry': '可尝试提供（0.5-1），进度 {progress}',
    'detail.internal.readyCommit': '待递交（进度 1）',
    'detail.currentItem': '当前物品',
    'detail.progress01': '当前进度',
    'detail.currentRecipe': '当前配方',
    'detail.productionProgress': '生产进度',
    'detail.lastCompletedCycleTicks': '上次耗时',
    'detail.lastCompletionIntervalTicks': '上次完成间隔',
    'detail.avgTransitTicks': '平均运输每件(tick)',
    'detail.cacheInputBuffer': '输入缓存',
    'detail.cacheOutputBuffer': '输出缓存',
    'detail.cacheInventory': '库存缓存',
    'detail.cacheSlot': '主槽缓存',
    'detail.cacheNsSlot': '南北槽缓存',
    'detail.cacheWeSlot': '东西槽缓存',
    'detail.empty': '空',
    'detail.pickupItem': '取货物品',
    'detail.pickupDialogTitle': '选择取货物品',
    'detail.itemPickerTitle': '物品选择',
    'detail.unselected': '未选择',
    'detail.preloadInput': '预置输入物品',
    'detail.preloadSlot': '槽位 {index}',
    'detail.preloadInputHint': '预置输入上限：总计 {cap}（共 {slots} 槽）',
    'detail.preloadInputTotal': '当前预置总量：{total}/{cap}',
    'detail.preloadDialogTitle': '选择预置物品（槽位 {index}）',
    'detail.submitWarehouse': '提交到仓库（每 10 秒批量）',
    'detail.tags': '标签',
    'toast.outOfLot': '位置不合法，超出可建造区域。',
    'toast.invalidPlacementFallback': '当前位置不满足放置规则。',
    'toast.rule.pickupRequiresBus': '取货口必须紧贴存取线基段放置。',
    'dialog.ok': '确定',
    'dialog.cancel': '取消',
    'dialog.title.warning': '提示',
    'dialog.title.confirm': '确认',
    'dialog.legacyUnknownTypesConfirm': '检测到旧存档不兼容设备类型：{types}。\n点击“确定”将删除无法识别的设备。',
    'dialog.legacyUnknownTypesStartBlocked': '当前存档包含无法识别的旧设备，请先确认删除后再开始仿真。',
  },
  'en-US': {
    'app.title': 'Industrial System Simulator Stage1',
    'app.language': 'Language',
    'top.start': 'Start Simulation',
    'top.stop': 'Exit Simulation',
    'top.zoomHint': 'Zoom: {size}px (max around 12x12 view, segmented steps)',
    'top.runningHint': 'Simulation running: editing disabled',
    'top.editHint': 'Edit mode: place/move/route/delete',
    'left.mode': 'Mode',
    'left.device': 'Devices',
    'left.group.logistics': 'Logistics',
    'left.group.resource': 'Resource Mining',
    'left.group.storage': 'Storage & IO',
    'left.group.basicProduction': 'Basic Production',
    'left.group.advancedManufacturing': 'Advanced Manufacturing',
    'left.group.power': 'Power',
    'left.group.functional': 'Functional',
    'left.group.combatSupport': 'Combat Support',
    'left.group.empty': 'No devices',
    'left.logisticsSubMode': 'Logistics Sub Mode',
    'left.placeBelt': 'Place Belt',
    'left.deleteSubMode': 'Delete Sub Mode',
    'left.deleteSingle': 'Single Cell',
    'left.deleteWholeBelt': 'Whole Belt',
    'left.deleteAll': 'Delete All',
    'left.deleteAllConfirm': 'Delete all devices? This action cannot be undone.',
    'right.lot': 'Base',
    'right.baseGroup.valley4': 'Valley 4',
    'right.baseGroup.wuling': 'Wuling',
    'right.baseGroup.empty': 'No bases',
    'right.basePlaceableSize': 'Placeable Area',
    'right.baseOuterRing': 'Outer Ring',
    'right.baseTags': 'Base Tags',
    'right.stats': 'Warehouse Stats',
    'right.simDebug': 'Simulation Debug',
    'right.selected': 'Selection Details',
    'right.noneSelected': 'No Selection',
    'debug.expectedTps': 'Expected Tick/s',
    'debug.measuredTps': 'Measured Tick/s',
    'debug.simTick': 'Current Tick',
    'debug.simSeconds': 'Sim Seconds',
    'debug.cellSeconds': 'Theoretical sec/cell',
    'debug.beltPerMin': 'Theoretical belt /min',
    'table.itemName': 'Item',
    'table.producedPerMinute': 'Produced/min',
    'table.consumedPerMinute': 'Consumed/min',
    'table.currentStock': 'Current Stock',
    'detail.instanceId': 'Instance ID',
    'detail.deviceType': 'Device Type',
    'detail.rotation': 'Rotation',
    'detail.position': 'Position',
    'detail.status': 'Status',
    'detail.currentStatus': 'Current Status',
    'detail.internalStatus': 'Internal Status',
    'detail.internal.noRuntime': 'Not in simulation',
    'detail.internal.canAccept': 'Can Accept (empty slot)',
    'detail.internal.occupiedHalf': 'Occupied (0-0.5), progress={progress}',
    'detail.internal.canTry': 'Can Try (0.5-1), progress={progress}',
    'detail.internal.readyCommit': 'Ready to Commit (progress=1)',
    'detail.currentItem': 'Current Item',
    'detail.progress01': 'Progress',
    'detail.currentRecipe': 'Current Recipe',
    'detail.productionProgress': 'Production Progress',
    'detail.lastCompletedCycleTicks': 'Last Duration',
    'detail.lastCompletionIntervalTicks': 'Last Completion Interval',
    'detail.avgTransitTicks': 'Avg Transit Ticks/Item',
    'detail.cacheInputBuffer': 'Input Buffer',
    'detail.cacheOutputBuffer': 'Output Buffer',
    'detail.cacheInventory': 'Inventory Buffer',
    'detail.cacheSlot': 'Main Slot',
    'detail.cacheNsSlot': 'NS Slot',
    'detail.cacheWeSlot': 'WE Slot',
    'detail.empty': 'Empty',
    'detail.pickupItem': 'Pickup Item',
    'detail.pickupDialogTitle': 'Select Pickup Item',
    'detail.itemPickerTitle': 'Item Picker',
    'detail.unselected': 'Unselected',
    'detail.preloadInput': 'Preloaded Input Items',
    'detail.preloadSlot': 'Slot {index}',
    'detail.preloadInputHint': 'Preload capacity: total {cap} ({slots} slots)',
    'detail.preloadInputTotal': 'Current preload total: {total}/{cap}',
    'detail.preloadDialogTitle': 'Select Preload Item (Slot {index})',
    'detail.submitWarehouse': 'Submit to Warehouse (batch every 10s)',
    'detail.tags': 'Tags',
    'toast.outOfLot': 'Invalid position: outside the buildable area.',
    'toast.invalidPlacementFallback': 'Current position does not satisfy placement rules.',
    'toast.rule.pickupRequiresBus': 'Pickup Port must be placed adjacent to a Warehouse Bus Segment.',
    'dialog.ok': 'OK',
    'dialog.cancel': 'Cancel',
    'dialog.title.warning': 'Notice',
    'dialog.title.confirm': 'Confirm',
    'dialog.legacyUnknownTypesConfirm': 'Legacy save contains unsupported device types: {types}.\nClick OK to remove unrecognized devices.',
    'dialog.legacyUnknownTypesStartBlocked': 'Current save still contains unrecognized legacy devices. Please resolve them before starting simulation.',
  },
}

const MODE_MESSAGES: Record<Language, Record<EditMode, string>> = {
  'zh-CN': {
    select: '选择模式',
    place: '放置模式',
    logistics: '物流模式',
    delete: '删除模式',
  },
  'en-US': {
    select: 'Select',
    place: 'Place',
    logistics: 'Logistics',
    delete: 'Delete',
  },
}

const DEVICE_MESSAGES: Record<Language, Record<DeviceTypeId, string>> = {
  'zh-CN': {
    item_port_unloader_1: '取货口',
    item_port_grinder_1: '粉碎机',
    item_port_furnance_1: '精炼炉',
    item_port_cmpt_mc_1: '配件机',
    item_port_shaper_1: '塑形机',
    item_port_seedcol_1: '采种机',
    item_port_planter_1: '种植机',
    item_port_winder_1: '装备原件机',
    item_port_filling_pd_mc_1: '灌装机',
    item_port_tools_asm_mc_1: '封装机',
    item_port_thickener_1: '研磨机',
    item_port_power_sta_1: '热能池',
    item_port_mix_pool_1: '反应池',
    item_port_xiranite_oven_1: '天有烘炉',
    item_port_dismantler_1: '拆解机',
    item_port_log_hongs_bus_source: '仓库存取线源桩',
    item_port_log_hongs_bus: '仓库存取线基段',
    item_port_liquid_storager_1: '储液罐',
    item_port_power_diffuser_1: '电桩',
    item_port_storager_1: '存储箱',
    belt_straight_1x1: '直线传送带',
    belt_turn_cw_1x1: '顺时针转角带',
    belt_turn_ccw_1x1: '逆时针转角带',
    item_log_splitter: '分流器',
    item_log_converger: '汇流器',
    item_log_connector: '桥接器',
  },
  'en-US': {
    item_port_unloader_1: 'Pickup Port',
    item_port_grinder_1: 'Crusher',
    item_port_furnance_1: 'Refinery Furnace',
    item_port_cmpt_mc_1: 'Component Machine',
    item_port_shaper_1: 'Shaper',
    item_port_seedcol_1: 'Seed Collector',
    item_port_planter_1: 'Planter',
    item_port_winder_1: 'Winder',
    item_port_filling_pd_mc_1: 'Filling Machine',
    item_port_tools_asm_mc_1: 'Packaging Machine',
    item_port_thickener_1: 'Thickener',
    item_port_power_sta_1: 'Thermal Pool',
    item_port_mix_pool_1: 'Reaction Pool',
    item_port_xiranite_oven_1: 'Xiranite Oven',
    item_port_dismantler_1: 'Dismantler',
    item_port_log_hongs_bus_source: 'Warehouse Bus Source',
    item_port_log_hongs_bus: 'Warehouse Bus Segment',
    item_port_liquid_storager_1: 'Liquid Storage Tank',
    item_port_power_diffuser_1: 'Power Pole',
    item_port_storager_1: 'Storage Box',
    belt_straight_1x1: 'Straight Belt',
    belt_turn_cw_1x1: 'CW Turn Belt',
    belt_turn_ccw_1x1: 'CCW Turn Belt',
    item_log_splitter: 'Splitter',
    item_log_converger: 'Converger',
    item_log_connector: 'Connector',
  },
}

const ITEM_MESSAGES: Record<Language, Record<string, string>> = {
  'zh-CN': {
    item_originium_ore: '源石矿',
    item_originium_powder: '源石粉末',
    item_iron_ore: '蓝铁矿',
    item_iron_nugget: '蓝铁块',
    item_iron_powder: '蓝铁粉末',
    item_plant_moss_3: '砂叶',
    item_plant_moss_seed_3: '砂叶种子',
    item_plant_moss_powder_3: '砂叶粉末',
    item_iron_enr_powder: '致密蓝铁粉末',
  },
  'en-US': {
    item_originium_ore: 'Originium Ore',
    item_originium_powder: 'Originium Powder',
    item_iron_ore: 'Blue Iron Ore',
    item_iron_nugget: 'Blue Iron Nugget',
    item_iron_powder: 'Blue Iron Powder',
    item_plant_moss_3: 'Sandleaf',
    item_plant_moss_seed_3: 'Sandleaf Seed',
    item_plant_moss_powder_3: 'Sandleaf Powder',
    item_iron_enr_powder: 'Dense Blue Iron Powder',
  },
}

export function createTranslator(language: Language) {
  return (key: string, params?: Record<string, string | number>) => {
    const template = MESSAGES[language][key] ?? key
    if (!params) return template
    return Object.entries(params).reduce((acc, [paramKey, paramValue]) => {
      return acc.replaceAll(`{${paramKey}}`, String(paramValue))
    }, template)
  }
}

export function getModeLabel(language: Language, mode: EditMode) {
  return MODE_MESSAGES[language][mode]
}

export function getDeviceLabel(language: Language, typeId: DeviceTypeId) {
  return DEVICE_MESSAGES[language][typeId]
}

export function getItemLabel(language: Language, itemId: string) {
  return ITEM_MESSAGES[language][itemId] ?? itemId
}
