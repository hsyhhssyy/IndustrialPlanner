# Stage1 验收与测试基线（Draft）

## 1. 验收总则

Stage1 通过标准：

- 功能闭环完整（搭建、连接、运行、观测、重置）。
- 关键统计可见且数值方向正确。
- 缺料状态可触发且提示明确。
- 50 台机器以内交互与模拟可用。

## 2. 功能验收用例

## AC-00 三栏布局与信息分区

前置：进入主界面。

期望：

- 页面为左中右三栏。
- 中间是 N×N 工业网格。
- 右侧上半显示总统计，下半显示选中建筑详情。

## AC-01 两级产线可运行

前置：创建“矿 -> 锭 -> 齿轮”产线。

期望：

- 模拟运行后 `gear` 库存持续增长。
- 面板可显示 `ore/power` 消耗速率。

## AC-02 增减机器影响产量

操作：增加或删除中间“锭”机器数量。

期望：

- `gear/min` 指标出现可观测变化。

## AC-02B 倍速切换生效

操作：在暂停、1x、2x、4x 间切换。

期望：

- 暂停时生产停止推进。
- 2x/4x 下单位现实时间内产量高于 1x。
- 配方数据本身不发生变化。

## AC-03 缺料状态可见

操作：中断上游输入或移除关键连接。

期望：

- 下游机器进入 `starved`。
- 显示缺失物品名称。

## AC-03B 重叠停机可见

操作：将两台建筑重叠放置。

期望：

- 重叠区域显示红色。
- 重叠建筑进入停机状态且不再正常产出。

## AC-04 非法连接阻断

操作：尝试 `out -> out` 或 `in -> in`。

期望：

- 连接创建失败。
- 提示非法连接。

## AC-04B 物流模式绘制连接

操作：点击“管道”或“传送带”模式，选择出入口并绘制路径创建连接。

期望：

- 成功生成对应模式连接。
- 路径在画布中可见并保留。

## AC-05 重置库存

操作：运行一段时间后执行“重置库存”。

期望：

- 库存回到初始状态。

## AC-06 选中、旋转与工具条

操作：点击建筑使其选中，按 `R` 或点击建筑上方“旋转”按钮。

期望：

- 右侧下半区域显示该建筑详情。
- 建筑旋转 90° 步进。
- 工具条可执行旋转与删除。

## AC-07 运行时约束符合预期

前置：完成 Stage1 打包并在静态环境运行。

期望：

- 应用可作为纯静态前端在浏览器中运行。
- 不依赖游戏引擎运行时。
- 核心能力（画布、仿真、统计）可在该运行形态下正常工作。

## AC-08 物品取货口边缘摆放约束

操作：将 3x1 物品取货口分别摆放在边缘与非边缘位置。

期望：

- 长边贴边时为有效摆放。
- 非贴边时标记为无效且不工作。
- 中间格为唯一有效出口。

## AC-09 传送带交汇行为

操作：分别构建交叉、分流、汇流三种单格节点。

期望：

- 交叉节点两路物品互不干扰直行。
- 分流节点按左/中/右顺序轮询输出（顺时针定义）。
- 汇流节点按左/中/右顺序轮询合流输出（顺时针定义）。
- 传送带重叠创建被拒绝。

## AC-10 供电覆盖生效

操作：放置 2x2 供电桩，将建筑移入/移出其 8x8 覆盖范围。

期望：

- 以供电桩中心 8x8 矩形范围内建筑为有电状态并可运行。
- 覆盖范围外建筑为无电状态并停机。

## AC-11 物流存储箱出货

操作：向存储箱输入物品并开启“每分钟提交系统外”。

期望：

- 存储箱可正常存储与出料。
- 系统外提交速率按配置生效。

## AC-12 灌装机端口布局

操作：放置 6x4 灌装机并验证端口边定义。

期望：

- 长边一侧为 6 个输入口。
- 对侧长边为 6 个输出口。

## AC-13 多配方选择

操作：为同一目标物品配置并切换至少两套配方。

期望：

- 可在界面选择不同配方。
- 切换后结算结果按新配方生效。

## AC-14 双产物配方兼容（暂未开放）

操作：加载包含双产物输出的配方数据。

期望：

- 数据可被读取、展示、保存与恢复。
- Stage1 不执行该配方结算，并显示“暂未开放”。

## AC-15 首批物品来源约束

操作：在无取货口输入条件下尝试获得 `originium_ore`。

期望：

- 系统中不存在非取货口来源的 `originium_ore`。

## AC-16 粉碎机首批配方

操作：为粉碎机选择“原矿粉碎（基础）”配方并运行。

期望：

- 每消耗 1 个 `originium_ore`，在 2 秒后产出 1 个 `originium_powder`。

## AC-17 传送带速度固定

操作：观察单个物品在传送带上的格子位移。

期望：

- 物品每 2 秒前进 1 格。
- 倍速切换影响时间流逝速率，但不改变该基础速度定义。

## 3. 性能基线

建议基线场景：

- 机器数：50
- 连接数：100（可按实际调整）
- tick：10~20Hz

通过标准：

- 画布操作（拖拽、缩放、平移）无明显卡顿。
- 模拟运行时统计刷新稳定，无明显冻结。

## 4. 回归清单（最小）

- 新建/删除机器
- 创建/删除连接
- 开始/暂停模拟
- 倍速切换（1x/2x/4x）
- 选中后 `R` 旋转
- 重叠红色提示与停机
- 物流模式路径绘制
- 传送带交汇（交叉/分流/汇流）
- 供电覆盖判定
- 取货口边缘摆放有效性
- 多配方切换
- 双产物配方兼容加载
- 源石矿来源约束
- 粉碎机首批配方
- 传送带固定速度
- 统计面板刷新
- localStorage 读写恢复

执行方式：

- Stage1 采用人工干预测试执行上述回归清单。
- 本阶段不强制引入 Playwright。

## 5. 非目标说明

- 不验证自动布局优化（Stage2）。
- 不验证传送带寻路与长度约束。
- 不引入游戏引擎作为 Stage1 运行时。
