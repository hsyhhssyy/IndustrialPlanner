# Stage1 UI 设计规范（当前实现）

> 本文档用于沉淀“当前可运行版本”的 UI 设计语言，重点覆盖视觉风格、设备外观、方向标识与状态反馈。

## 1. 设计目标

- 以“工业编辑器”定位为核心：清晰、稳重、信息密度高。
- 在深色背景下保证可读性与状态辨识度。
- 编辑态与仿真态共用同一视觉系统，仅通过状态高亮与文案提示区分。

## 2. 页面布局

### 2.1 三栏结构

- 左栏（`260px`）：工具栏，负责模式切换与设备/物流操作。
- 中栏（自适应）：网格画布，承载设备放置与物流可视化。
- 右栏（`340px`）：信息面板，负责统计、地块切换与选中对象详情。

地块规格（当前实现）：`60x60` 与 `40x40`。

### 2.2 顶栏

- 高度 `56px`，用于仿真总控：开始/退出仿真、倍速按钮、提示信息。
- 顶栏左上角提供语言切换（`中文 / English`）下拉框。
- 语言切换后页面文案应立即更新，并在刷新后保持上次选择。
- 顶栏与主内容区通过边线分隔，形成清晰的操作层级。

### 2.3 文案与 i18n

- 所有面向用户的核心 UI 文案必须接入统一 i18n 词典（禁止在组件内散落硬编码文案）。
- Stage1 至少覆盖：模式名称、按钮文案、面板标题、表头、详情字段、提示文案。
- 文案 fallback 规则：若翻译键缺失，应回退到稳定默认文案，不得显示异常占位符。
- 中英文切换仅影响显示层，不改变任何业务逻辑、坐标或仿真结果。

## 3. 视觉风格（Style Tokens）

### 3.1 字体

- 全局字体栈：`Segoe UI` / `PingFang SC` / `Microsoft YaHei` / `sans-serif`。
- 中文优先可读，英文与数字兼容展示。

### 3.2 颜色基调

- 页面背景：深灰蓝（`#151a22`）。
- 卡片/面板背景：更浅一层深蓝灰（`#1b222d`）。
- 分割线与边框：低对比冷灰蓝（`#2f3a4a`）。
- 正文文字：浅灰蓝（`#e5ebf3`）。
- 次级说明文字：低亮度灰蓝（`#a7b0bf` / `#b2bfd2`）。

### 3.3 控件形态

- 按钮统一小圆角（`6px`），边框+填充形成“可点击块”感。
- 激活按钮使用蓝色高亮底（`#395c93`）与更亮边框（`#4f7bc4`）。
- 禁用态统一降低不透明度并禁用手势（`opacity: 0.5` + `not-allowed`）。

## 4. 画布与网格视觉

### 4.1 画布框体

- 画布容器为卡片式面板，内部是固定像素正方形舞台。
- 舞台背景为深色（`#161c27`），外框使用细边线。

### 4.2 网格与边界

- 网格线颜色为低对比灰（`#2c3340`），强调“辅助定位”而非主视觉元素。
- 工业区外框使用橙色高亮（`#f28c28`），明确可操作边界。

### 4.3 视口反馈

- 支持滚轮缩放、空格/中键平移。
- 缩放/平移不改变逻辑坐标，仅改变观察视口。

### 4.4 画布分层（Z-Index 规范）

为避免遮挡歧义，Stage1 画布分层固定为以下顺序（数字越大越靠上）：

- `0`：网格背景（含地块边界）
- `1`：端口箭头（Chevron）
- `2`：传送带（带体与方向箭头）
- `3`：在途物品
- `4`：其他设备（非传送带设备）
- `5`：交互预览（放置虚影、框选框、物流路径预览）
- `6`：临时覆盖层（调试或临时可视化）

补充约束：

- 在途物品应使用统一覆盖层渲染，不嵌入单个带格内部渲染。
- 选中高亮不改变设备所属主层级（只改变描边/样式）。

## 5. 设备外观规范

### 5.1 设备主体

- 设备形状统一为矩形块，保持工程化、模块化视觉。
- 正常设备填充：蓝色系（`#2d4a78`），描边：`#5f7fb3`。
- 选中设备描边高亮：金色（`#f7d06a`）。
- 无效/阻塞设备填充：暗红（`#6a1f2e`），描边：亮红（`#ff6b6b`）。

### 5.2 设备文字

- 设备中心显示短名（`shortName`），无短名时回退名称。
- 文本颜色统一浅色（`#e5ebf3`），保持深底对比度。
- 文本始终正向显示，不跟随旋转翻转。

### 5.3 摆放与拖拽反馈

- 放置预览：半透明虚框。
- 合法放置预览：冷蓝色；非法越界预览：红色。
- 拖拽中的原始位置显示半透明“幽灵框”，便于对比移动前后位置。

## 6. 端口与方向标识

### 6.1 端口形状

- 端口使用“箭头化多边形”，直接表达流向语义。
- 端口根据方向旋转（`+x/-x/+y/-y`），保持朝向一致性。

### 6.2 端口配色

- 输出端口（`out`）：绿色（`#37c87a`）。
- 输入端口（`in`）：红色（`#ff5d5d`）。
- 当前物流拖拽起点端口：高亮黄（`#ffd166`）。

### 6.3 端口-带体连接视觉

- 当端口与带体邻接时，使用双层线段补全视觉连接。
- 外层深色、内层浅色，保持与传送带轨道一致的材质风格。

## 7. 传送带与节点外观

### 7.1 轨道线

- 传送带采用双层线：
  - 外层深绿（`#3e5a4e`）
  - 内层浅绿（`#bfe8d5`）
- 预览中轨道切换为棕黄系，区分“未提交路径”。

### 7.2 方向箭头

- 每条带段中部显示小三角箭头，表达当前可通行方向。
- 箭头颜色与轨道保持同色系，避免视觉噪声。

### 7.3 末端与微节点

- 未连接端点显示“端帽”线段，提示死端。
- 拐角/分汇流关键点显示双层圆点，强化拓扑可读性。

## 8. 在途物品视觉

- 在途物品以小方块表示，沿带段按 tick 插值移动。
- `item_originium_ore`：灰白系（填充 `#c9d1db`，描边 `#7e8a99`）。
- `item_originium_powder`：紫色系（填充 `#d7c0ff`，描边 `#7a5bb8`）。
- 拐角移动使用“两段式过渡”，减少视觉跳变。

## 9. 状态反馈系统

### 9.1 设备状态

- 摆放异常：显示“重叠停机”或“越界”（重叠允许摆放，但属于非法状态）。
- 运行异常：显示运行态状态文案（如 `starved` / `unpowered` 等）。
- 文案统一使用浅红色，位于设备区域内偏下位置。

状态语义补充：`starved` 为显示层状态，语义等同 `Idle`（未工作），并非新增运行态枚举。

状态词与运行态映射（Stage1）：

| UI 状态词 | 类型 | 运行态来源 | 触发条件（判定优先级从高到低） |
| --- | --- | --- | --- |
| overlap | 摆放/运行异常 | `stallReason=OVERLAP` | 占格冲突（可摆放但非法；进入仿真后按停机处理） |
| unpowered | 运行异常 | `stallReason=NO_POWER` | `requiresPower=true` 且未满足供电覆盖 |
| config_error | 运行异常 | `stallReason=CONFIG_ERROR` | 配置非法（如取货口未选择物品） |
| output_blocked | 运行异常 | `stallReason=OUTPUT_BLOCKED` | 可产出但下游不可接收 |
| starved | 显示层状态 | `stallReason=NO_INPUT` | 输入不足 |
| running | 运行中 | `stallReason=NONE` | 本 tick 正常推进且无停机原因 |

### 9.2 取货口特殊提示

- 取货口未选物品时，在设备中央显示 `?`（黄色高亮）。

### 9.3 选中反馈

- 画布中：设备描边高亮，或传送带格显示高亮边框。
- 右侧面板中：联动显示当前选中设备/带格详情。

## 10. 面板信息设计

### 10.1 右侧统计区

- 采用卡片 + 表格展示仓库物品总量与 `/min` 变化速率。
- 明确标注“仓库统计”口径，并与地图设备状态展示解耦。

统计时间口径：`/min` 基于仿真时间计算，不受 `1x/2x/4x/16x` 倍速影响。

### 10.2 详情区

- 统一使用两列键值栅格（字段名 / 字段值）。
- 对长值启用自动换行，避免布局撑破。
- 根据选中对象类型切换设备详情或传送带详情。

## 11. 交互一致性原则

- 颜色语义固定：
  - 蓝 = 常规设备
  - 绿 = 输出/可流动
  - 红 = 输入/错误/禁用
  - 黄 = 当前焦点/起点/选中强调
- 所有可编辑动作在仿真态受限，并通过按钮禁用与提示文案双重反馈。
- 同类操作（模式切换、按钮选中、删除子模式）复用同一控件样式，降低学习成本。

## 12. 后续可演进建议（不影响当前实现）

- 将颜色、间距、字号抽成设计 Token，便于主题化与规范复用。
- 为运行状态（`running/starved/unpowered`）增加图标层，减少英文状态词依赖。
- 将端口/轨道/节点的绘制参数统一配置化，便于不同缩放级别下的视觉优化。
