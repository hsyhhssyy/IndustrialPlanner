# 04 UI 与交互实现指南

## 1. 页面骨架

严格遵循三栏 + 顶栏：

- 左栏：工具栏（模式切换、设备选择、物流子模式、删除子模式）
- 中栏：网格画布（放置/拖拽/框选/铺带）
- 右栏：统计与选中对象详情
- 顶栏：仿真控制（开始/退出/倍速/提示）

## 2. 交互状态机

建议使用显式编辑模式机：

- `select`
- `place`
- `logistics`
- `delete`

并维护以下子状态：

- 当前选中对象（设备/带格/空）
- 当前设备类型（place 模式）
- 当前物流子模式（Stage1 仅传送带）
- 当前删除子模式（单格 / 整条联通带）

## 3. 选择模式

- 单击设备选中；再次点击空白取消
- 支持拖拽移动与框选移动
- `R` 键旋转选中设备
- 拖拽时展示原位置幽灵框

## 4. 放置模式

- 设备以左上角锚点放置
- 放置预览必须区分合法/非法
- 非法原因至少覆盖：越界、重叠

## 5. 物流模式（传送带）

路径输入规则：

- 按住左键拖拽铺设
- 仅允许格线方向，不允许单格铺设
- 起点可为：设备输出端口 / 空地 / 传送带
- 终点可为：设备输入端口 / 空地 / 传送带

自动节点规则：

- 终点接入已有传送带：自动创建 `merger`
- 起点来自已有传送带：自动创建 `splitter`
- 跨越直线带：自动创建 `bridge`
- 禁止跨拐角带

## 6. 删除模式

- 单格删除：删除目标格设备
- 整条联通带：按 4 邻接删除整条连通传送网络
- 遇到 `bridge`：其 N-S 与 W-E 两条通道独立判定与删除

## 7. 视觉规范映射

来自 UI 文档的关键语义必须落地：

- 正常设备：蓝色系；选中边框：金色；异常：红色系
- 输出端口绿色，输入端口红色，物流起点高亮黄色
- 传送带轨道双层线 + 中部方向箭头
- 工业区边界使用橙色强调
- 可编辑动作在仿真态受限（禁用 + 文案提示双反馈）

## 8. 信息面板

### 8.1 统计区

- 卡片 + 表格展示系统外库存与 `/min` 产消速率
- 字段稳定排序，与仿真统计口径一致

### 8.2 详情区

- 两列键值布局
- 随选中对象类型切换设备详情/传送带详情
- 展示停机原因与关键运行字段（如 `progress01`）

## 9. 可用性守则

- 同类按钮复用一致样式与激活态
- 快捷键只保留 Stage1 必需项（如 `R`）
- 禁止新增与 PRD 无关的过滤器、浮窗、页面跳转
