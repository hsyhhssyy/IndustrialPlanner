# 07 Stage1 FAQ（口径澄清）

## Q1：为什么退出仿真要“清空仓库统计快照”？

两者不是同一概念：

- 清空仓库统计快照：指清空本轮仿真的仓库统计累计值。
- 清空仓库物品数量：退出仿真后仓库数量不保留。

因此，退出仿真后会从干净统计状态重新累计。

并且，Stage1 统一口径为：每次进入仿真时，仓库都从统一初始值重建：`item_originium_ore=∞`，其他物品=`0`。

## Q2：`/min` 会不会受 `x16` 倍速影响？

不会。

`/min` 统一按仿真时间计算。倍速只改变“现实时间里每秒跑多少 tick”，不改变同一段仿真时间下的统计结果。

时间口径总则：在所有文档中，凡提到 X 秒 / X 分钟，均按仿真时间定义：`1 秒 = 20 tick`、`1 分钟 = 1200 tick`；该口径不受仿真倍速影响。

术语补充：`标准秒` 指规则层时间单位，语义上等同“与仿真倍速无关的 1 秒”。

## Q3：是否允许孤立物流（空地到空地的传送带）？

允许。孤立物流是合法编辑结果。

## Q4：删除孤立物流时，统计要做额外处理吗？

不需要额外补偿逻辑：

- 孤立物流不参与产消结算。
- 删除时按现有删除模式执行（单格或 4 邻接整段）。
- 删除后进行拓扑重建即可，统计在后续 tick 自然反映变化。

## Q5：`starved` 和 `Idle` 是什么关系？

`starved` 是显示层文案，语义等同 `Idle`（未工作）。

运行逻辑与判定仍以 `stallReason` 及运行态字段为准，不新增 `STARVED` 枚举值。

## Q6：Stage1 当前支持哪些地块规格？

当前提供两种地块：

- `60x60`
- `40x40`

右侧信息面板可进行地块切换（如当前实现已提供）。

## Q7：为什么把 `filler_6x4` 移出 Stage1？

为减少阶段内歧义并聚焦最小闭环产线，`filler_6x4` 已从 Stage1 冻结清单移除。

Stage1 仅保留 `item_originium_ore -> item_originium_powder` 所需设备与规则。

## Q8：设备“是否需要电力”在哪里定义？

这是领域模型的一部分，由设备类型字段 `requiresPower` 显式声明。

Stage1 当前口径：仅 `item_port_grinder_1` 的 `requiresPower=true`，其余设备为 `false`。

## Q9：2x2 供电桩的 12x12 覆盖边界如何理解？

以主规范为准：`docs/domain-model-data.yaml` 的 `powerModel`（含 `discreteEvaluation`）是唯一权威定义。

其几何语义为：以供电桩为中心构造一个 `12x12` 的正方形供电区域，供电桩 `2x2` 本体位于该区域几何中心；目标建筑任意占格落入该区域即判定有电。

离散实现口径（与主规范一致）：

- 以供电桩左上角格为锚点 `(x,y)`。
- 供电桩本体占据 `(x,y)~(x+1,y+1)`。
- 等价离散判定区间：`x:[x-5,x+6]`、`y:[y-5,y+6]`（含边界）。

若 FAQ 与主规范文字不一致，统一以 `docs/domain-model-data.yaml` 为准。

## Q10：Bridge 的槽位模型是什么？

`item_log_connector` 采用“双通道双槽位”：

- N-S 通道一个槽位（`nsSlot`）
- W-E 通道一个槽位（`weSlot`）

两条通道互不干扰。

## Q11：终点命中直线带时是 `merger` 还是 `bridge`？

按“当前路径语义”实时重判：

- 当某格是**当前终点**且命中直线带格时，显示临时 `merger`。
- 若继续拖拽使该格从“终点”变为“路径内部节点”，该临时节点立即改判为临时 `bridge`。
- 轨迹绘制过程中仅生成临时预览，不落盘。
- 鼠标释放后，按最终路径一次性生成实际设备。

判定优先级：起点 `splitter`、终点 `merger` 优先于路径内部跨越 `bridge`。

## Q12：Bridge 需要区分左手性和右手性吗？

Stage1 不建议引入 left/right handed 两种 Bridge 设备。

当前 `item_log_connector` 只承担“正交双通道穿越”语义（N-S 与 W-E），与左右手无关。

建议：

- Stage1 保持单一 Bridge 类型，减少建模与交互复杂度。
- 若未来要支持“跨格换道/编织”或更复杂拓扑，再在 Stage2+ 引入带手性的专用节点。

## Q13：不定义手性时，如何避免 Bridge 语义歧义？

通过“固定通道映射”解决：

- 南北通道仅允许 `N->S` 与 `S->N`
- 东西通道仅允许 `W->E` 与 `E->W`

并增加两条硬约束：

- 禁止同边回送（如 `N->N`）
- 禁止跨通道转向（如 `N->E`）

因此，Bridge 可以在“无手性”的前提下保持“有方向”的对侧连通语义。

## Q14：重叠到底是“禁止放置”还是“可放置但停机”？

Stage1 口径统一为：**可放置但非法**。

- 编辑态：重叠**不阻止**放置与移动；即使发生重叠，编辑动作依然可提交。
- 数据层：重叠允许落盘，用于保留玩家操作结果与后续修复路径。
- 运行态：进入仿真后命中 `stallReason=OVERLAP`，按“重叠停机”展示与处理。

额外澄清（避免混淆）：

- 重叠规则与“放置约束规则”是两套独立机制。
- 例如“取货口需与 bus 邻接”这类放置约束，会在放置/移动时即时校验；
- 而重叠不会参与放置/移动拦截，只在仿真阶段统一按 `OVERLAP` 停机处理。

因此，“不允许重叠”描述的是规则语义；“可放置”描述的是编辑器行为，两者不冲突。

## Q15：存储箱提交到仓库是固定行为吗？

不是固定行为，属于用户可配置项。

- 配置项：`submitToWarehouse`（布尔值）。
- 默认值：`true`（即默认提交）。
- 含义：开启时按仿真时间每 1 秒批量提交一次该存储箱内所有物品到全局仓库统计池；关闭时不提交。

该口径与取货口“选择取出物品”一致，都是用户可选配置。

## Q16：`pickup_port` 未选物品何时判定 `CONFIG_ERROR`？

进入仿真即判定。

Stage1 口径为：所有 `CONFIG_ERROR` 类型都在仿真启动阶段统一校验并立即报错，不延后到运行中触发。

## Q17：“禁止单格铺设”如何精确定义？

定义为路径长度至少 2 格。

也就是拖拽路径必须覆盖两格及以上；长度为 1 格的铺设请求一律判定非法。

## Q18：删除“整条联通带”会删除 `splitter/merger/bridge` 吗？

不会。

Stage1 口径为：整条联通带批量删除仅作用于 `belt_*` 纯传送带格；`splitter/merger/bridge` 不在该批量删除范围内。