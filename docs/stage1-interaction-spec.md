# Stage1 交互规范（Draft）

## 1. 页面分区

- 页面固定为左中右三栏。
- 左侧：工具栏（建筑分类、物流模式）。
- 中间：工业区域（N×N 网格）。
- 右侧：信息面板（上半总统计，下半选中建筑详情）。
- 顶部：固定仿真控制条（开始仿真/退出仿真、1x/2x/4x）。

地块尺寸：

- Phase1 提供 `100x100`、`80x80`、`60x60` 三种地块尺寸选择。
- 进图默认尺寸为 `60x60`。
- 切换尺寸时弹窗确认并执行地块存档切换（先保存当前，再加载目标）。
- 若目标尺寸无存档，则创建该尺寸空地块并加载。
- Phase1 约定尺寸即地块名；后续版本可扩展为“地块名 + 尺寸”。

## 2. 画布与坐标

- 画布为二维网格背景。
- 机器锚点为左上角。
- 所有坐标以网格整数记录。
- 工业区域边界外不可放置建筑。

## 3. 缩放与视口

- 滚轮缩放以“可见格数”作为步进单位。
- 每次缩放均为整格数变化，不允许小数格缩放。
- 最小缩放级别要求可见整个 N×N 工业区域。
- 平移仅改变视口，不改变建筑逻辑坐标。

## 4. 建筑放置与删除

- 从左侧建筑工具拖拽到工业区域即可放置。
- 建筑从工业区域拖出到区域外时，在鼠标松开时判定删除。
- 删除建筑时，关联连接应同步删除。

## 5. 选择与移动

## 2.1 单选

- 点击机器：选中该机器。
- 点击空白：取消选择。

选中反馈：

- 右侧下半区域显示该建筑详情。
- 选中建筑上方显示悬浮工具条（旋转、删除）。

## 2.2 框选

- 鼠标拖拽框选矩形区域。
- 被框中的机器全部进入选中集合。

## 2.3 拖拽移动

- 拖拽单机：仅移动该机器。
- 拖拽多选集合：整体平移。
- 移动后坐标应对齐到网格。

## 6. 旋转

- 选中建筑时按 `R` 执行旋转（90° 步进）。
- 悬浮工具条中的“旋转”与键盘 `R` 行为一致。

## 7. 重叠与失效反馈

- 建筑允许重叠摆放。
- 重叠区域显示为红色高亮。
- 发生重叠的建筑标记为不可工作状态。
- 物品取货口未满足“长边贴边”时，标记为无效摆放并不可工作。

## 8. 物流模式与连接交互

- 工具栏提供物流模式按钮，至少包含“管道”“传送带”。
- 管道模式在 Phase1 仅占位展示，不参与可运行连接结算。
- 点击物流模式按钮后进入对应绘制模式。
- 在该模式中：点击建筑出入口并绘制路径，完成后创建连接。
- 若路径与现有传送带产生重叠，应拒绝创建并提示。

传送带绘制补充：

- 可从任意建筑出口格起笔，终点可落在任意空地格。
- 可从任意传送带断点起笔，终点可落在任意建筑入口格。
- 绘制中不允许回头。
- 路径严格沿网格，不允许曲线。

## 3.1 创建连接

- 从 `out` 端口按下并拖拽到 `in` 端口，松开后创建。
- 若目标端口不合法，连接取消并提示失败。
- 已绘制路径作为连接显示路径保留。

## 3.2 非法连接处理

- `out -> out`：拒绝。
- `in -> in`：拒绝。
- 重复连接：拒绝。

## 3.3 删除连接

- 选中连接后可删除。
- 删除机器时关联连接应自动删除。

## 9. 删除行为

- 删除单机：移除机器与其关联连接。
- 删除多选：批量移除机器与关联连接。

传送带删除：

- 选中传送带后，悬浮工具条提供“逐格删除”“删除全部联通传送带”两种操作。
- 删除全部联通传送带不需要二次确认。
- 联通定义采用 4 邻接（上/下/左/右），不包含对角。

## 10. 运行速率控制

- 屏幕最上方固定提供“开始仿真/退出仿真”按钮与速率按钮：1x、2x、4x。
- 点击“开始仿真”后进入仿真模式并锁定编辑。
- 点击“退出仿真”后返回编辑模式，并清空全部运行态内容（系统外仓库库存、机器进度、机器内部物品、传送带在途物品等）。
- 仿真模式下左侧编辑工具不可执行：放置、拖拽移动、删除、旋转、连线、地块切换。
- 配方与配置数据均以 1x 为基准。
- 切换速率后仅影响仿真推进速度。

## 11. 状态反馈

- 支持滚轮缩放。
- 支持按住中键或空格拖拽平移（具体按键待实现时确定）。
- 视图缩放不改变机器逻辑坐标。

## 6. 状态反馈

- 机器显示运行状态：运行中 / 缺料 / 重叠停机。
- 缺料状态应显示缺失物品名。
- 非法连接操作提供可见反馈（如提示文本）。

停机样式：

- 无电、重叠、缺料时在机器中心显示状态图标。
- 同时在机器边缘显示红框。

取货口交互：

- 取货口放置后默认不出货。
- 用户选中取货口后，在右下详情区选择具体物品后才开始出货。
- 未选择物品时显示“未选物品”图标。
- “未选物品”图标固定为 `?`。
- 取货口为 `3x1`，有效性仅判定“长边贴边”；不要求在 Phase1 强制选择方向。
- 若实现需要，可在数据层增加可选方向字段（`top/right/bottom/left`）显式指定出口朝向。

右侧上半区域内容：

- 显示每种物品当前存量。
- 显示每种物品每分钟生产与每分钟消耗。
- 矿物库存显示为“无穷”。
- 物品排序规则：`originium_ore` 优先，其次 `originium_powder`，其余按 `itemId` 字母序。

## 12. Stage1 明确不做

- 连接自动寻路（仅支持手绘路径）。
- 复杂编辑器交互（如层级锁定、吸附线精细配置）。

## 15. 端口旋转计算规则

- 建筑配置仅提供 0° 朝向端口坐标。
- 90°/180°/270° 端口坐标由运行时根据建筑尺寸与旋转角自动推导。
- 旋转仅支持 90° 步进，因此端口坐标可通过整数网格变换得到。

## 13. 实现约束（运行时）

- Stage1 交互系统基于浏览器前端实现，不依赖游戏引擎。
- 该约束确保静态部署与迭代效率，适配 GitHub Pages 托管目标。

## 14. Phase1 建筑视觉规范

- 所有建筑统一使用粗边框矩形外观。
- 出入口格以箭头显示方向。
- 建筑中心显示汉字名称。
- 建筑旋转时名称保持正向，不随建筑旋转。

## 16. 供电覆盖坐标冻结

- 供电桩尺寸为 `2x2`，其本体位于 `12x12` 覆盖框中心区域。
- 若供电桩左上角为 `(x, y)`，则供电覆盖框左上角为 `(x - 5, y - 5)`，尺寸固定为 `12x12`。
- 目标建筑任一格坐标落入该覆盖框即判定“有电”。
- 覆盖框超出工业区域边界时，先按边界裁剪后再判定。
