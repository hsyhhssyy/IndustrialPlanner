# Stage1 交互规范（Draft）

## 1. 页面分区

- 页面固定为左中右三栏。
- 左侧：工具栏（建筑分类、物流模式、倍速控制）。
- 中间：工业区域（N×N 网格）。
- 右侧：信息面板（上半总统计，下半选中建筑详情）。

## 2. 画布与坐标

- 画布为二维网格背景。
- 机器锚点为左上角。
- 所有坐标以网格整数记录。
- 工业区域边界外不可放置建筑。

## 3. 缩放与视口

- 滚轮缩放以“可见格数”作为步进单位。
- 每次缩放均为整格数变化，不允许小数格缩放。
- 最小缩放级别要求可见整个 N×N 工业区域。
- 平移仅改变视口，不改变建筑逻辑坐标。

## 4. 建筑放置与删除

- 从左侧建筑工具拖拽到工业区域即可放置。
- 建筑从工业区域拖出到区域外时，视为删除。
- 删除建筑时，关联连接应同步删除。

## 5. 选择与移动

## 2.1 单选

- 点击机器：选中该机器。
- 点击空白：取消选择。

选中反馈：

- 右侧下半区域显示该建筑详情。
- 选中建筑上方显示悬浮工具条（旋转、删除）。

## 2.2 框选

- 鼠标拖拽框选矩形区域。
- 被框中的机器全部进入选中集合。

## 2.3 拖拽移动

- 拖拽单机：仅移动该机器。
- 拖拽多选集合：整体平移。
- 移动后坐标应对齐到网格。

## 6. 旋转

- 选中建筑时按 `R` 执行旋转（90° 步进）。
- 悬浮工具条中的“旋转”与键盘 `R` 行为一致。

## 7. 重叠与失效反馈

- 建筑允许重叠摆放。
- 重叠区域显示为红色高亮。
- 发生重叠的建筑标记为不可工作状态。
- 物品取货口未满足“长边贴边”时，标记为无效摆放并不可工作。

## 8. 物流模式与连接交互

- 工具栏提供物流模式按钮，至少包含“管道”“传送带”。
- 点击物流模式按钮后进入对应绘制模式。
- 在该模式中：点击建筑出入口并绘制路径，完成后创建连接。
- 若路径与现有传送带产生重叠，应拒绝创建并提示。

## 3.1 创建连接

- 从 `out` 端口按下并拖拽到 `in` 端口，松开后创建。
- 若目标端口不合法，连接取消并提示失败。
- 已绘制路径作为连接显示路径保留。

## 3.2 非法连接处理

- `out -> out`：拒绝。
- `in -> in`：拒绝。
- 重复连接：拒绝。

## 3.3 删除连接

- 选中连接后可删除。
- 删除机器时关联连接应自动删除。

## 9. 删除行为

- 删除单机：移除机器与其关联连接。
- 删除多选：批量移除机器与关联连接。

## 10. 运行速率控制

- 左侧工具栏提供速率按钮：暂停、1x、2x、4x。
- 配方与配置数据均以 1x 为基准。
- 切换速率后仅影响仿真推进速度。

## 11. 状态反馈

- 支持滚轮缩放。
- 支持按住中键或空格拖拽平移（具体按键待实现时确定）。
- 视图缩放不改变机器逻辑坐标。

## 6. 状态反馈

- 机器显示运行状态：运行中 / 缺料 / 重叠停机。
- 缺料状态应显示缺失物品名。
- 非法连接操作提供可见反馈（如提示文本）。

## 12. Stage1 明确不做

- 连接自动寻路（仅支持手绘路径）。
- 复杂编辑器交互（如层级锁定、吸附线精细配置）。

## 13. 实现约束（运行时）

- Stage1 交互系统基于浏览器前端实现，不依赖游戏引擎。
- 该约束确保静态部署与迭代效率，适配 GitHub Pages 托管目标。
