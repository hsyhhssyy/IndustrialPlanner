# Stage3 需求池与执行清单（可持续补充）

> 目的：承接 Stage2 代码核对后的未完成项，并作为 Stage3 新需求与细节的统一落盘入口。
>
> 更新规则：
> - 你后续补充的新需求，直接追加到「3. 新增需求池（待补充）」。
> - 每条需求都要绑定验收标准（DoD）与影响面。
> - 设计、测试、发布文档引用本文件编号，避免需求漂移。

## 1. 来源与基线

- 基线代码：`main`（核对日期：2026-03-01）
- 基线文档：`.docs/stage2/*`（冻结口径）
- 迁移目标：将 Stage2 未落地项统一纳入 Stage3 执行

## 2. Stage2 未落地迁移项（已确认）

### 2.1 S3-RQ-001 电力模型补齐

- 状态：`todo`
- 来源：Stage2 冻结外移项 + 代码核对
- 需求：
  - 引入设备级 `powerDemand/powerSupply`
  - 提供总耗电/总发电/净功率
  - 提供即时值、10 分钟、1 小时统计（标准秒）
- 代码现状证据：
  - 当前仅 `requiresPower`：`src/domain/types.ts`、`src/domain/registry.ts`
  - 仍有 `NO_POWER` 停机：`src/sim/engine.ts`
- DoD：
  - 设备功率字段全量可读
  - 统计窗口按标准秒滚动
  - UI 可观测且与仿真口径一致

### 2.2 S3-RQ-002 缺电语义改造

- 状态：`todo`
- 需求：
  - 缺电不触发停机/降速
  - 仅保留“接网前置”运行门槛
- 代码现状证据：
  - `NO_POWER` 位于硬阻塞集合：`src/sim/engine.ts`
- DoD：
  - 缺电时设备持续运行
  - 未接网设备仍不可运行

### 2.3 S3-RQ-003 管道等效容量模型

- 状态：`deprecated`
- 决策：该需求已废弃，不进入 Stage3。

### 2.4 S3-RQ-004 管道单液体锁定与排空切换

- 状态：`deprecated`
- 决策：该需求已废弃，不进入 Stage3。

### 2.5 S3-RQ-005 抽水泵效率配置化

- 状态：`todo`
- 需求：
  - 抽水泵输出效率来自领域模型配置
  - 吞吐按效率结算
- 代码现状证据：
  - 当前仅配置输出液体类型，无效率字段：`src/domain/types.ts`、`src/features/build/useBuildPickerDomain.ts`
- DoD：
  - 不同效率配置对应不同稳定吞吐
  - 与外圈放置规则不冲突

### 2.6 S3-RQ-006 瓶装液体选择与执行口径

- 状态：`deprecated`
- 决策：该需求已废弃，不进入 Stage3。

### 2.7 S3-RQ-007 反应池口径确认

- 状态：`done`
- 决策：反应池已完成验收，正确口径为“5 共享槽位”。
- 备注：该项不再进入 Stage3 开发，仅作为基线回归检查。

## 3. 新增需求池（待补充）

> 你后续补充 Stage3 新需求时，按以下模板追加：

### 3.X S3-RQ-XXX 需求标题

- 状态：`todo | partial | done`
- 业务价值：
- 详细需求：
- 非目标（可选）：
- 影响面（domain/sim/ui/data/test）：
- 依赖项：
- 风险与回滚点：
- 验收标准（DoD）：

## 4. 执行节奏建议

- M1：电力模型与语义改造（S3-RQ-001/002）
- M2：抽水泵效率配置化（S3-RQ-005）
- M3：Stage2/Stage3 回归收口（含反应池 5 共享槽位基线）

## 5. 追踪约定

- 状态取值：`todo`、`partial`、`done`、`blocked`
- 需求编号稳定，不因排序变化而修改
- 任一需求进入开发前，必须补齐 DoD 与影响面
