# 05 开发计划与任务拆分

## 1. 建议里程碑

- **M1：基础框架完成**
  - 设备定义、网格占用、端口旋转、基础放置/删除
- **M2：编辑器可用**
  - 四模式交互、拖拽与框选、物流铺设与自动节点
- **M3：仿真可跑**
  - Tick 循环、Plan/Commit、带体双区间进度、基础配方
- **M4：观测与收口**
  - 统计面板、停机原因、仿真控制、存档与回归

## 2. 工作分解结构（WBS）

## 2.1 Domain 与定义

1. 建立 item / recipe / device type registry
2. 落地 `runtimeKind` 与端口基准定义
3. 实现旋转后端口映射与连接判定
4. 构建设备实例与占格冲突检测

## 2.2 编辑态系统

1. 模式状态机与工具栏事件流
2. 选择、移动、框选、旋转
3. 放置预览与非法提示
4. 物流拖拽、路径采样、自动节点生成
5. 删除单格与 4 邻接整段删除

## 2.3 仿真系统

1. runtime state 初始化与销毁
2. Phase A 计划器（可交接判断）
3. Phase B 提交器（进度推进 + 交接写入）
4. processor/storage/conveyor/junction 执行器
5. 倍速驱动与 tick 调度器

## 2.4 UI 展示与观测

1. 画布渲染（设备、端口、带体、在途物品）
2. 右栏统计与详情面板
3. 停机状态可视化
4. 顶栏仿真控制与提示文案

## 2.5 持久化与稳定性

1. localStorage 存档结构
2. 编辑态数据恢复
3. 异常数据兜底（版本字段、兼容处理）

## 3. 任务优先级

- **P0（阻塞上线）**：连接正确性、Plan/Commit、基础闭环产线、停机原因
- **P1（强建议）**：统计稳定性、交互一致性、删除联通带
- **P2（可延后）**：文案打磨、细节视觉优化（不改变设计语义）

## 4. 交付节奏建议

- PR 按“单主题”提交：编辑系统 / 仿真系统 / UI 面板分开

## 5. 风险与对策

1. **拓扑更新延迟导致脏连接**
   - 对策：编辑命令后统一触发连接缓存重建
2. **并发交接导致双写/漏写**
   - 对策：Plan 阶段会进行判断，如确实有问题会设置设备状态
3. **仿真退出残留状态**
  - 对策：集中 `resetRuntime()` 清空全部运行态与仓库统计快照
4. **UI 与仿真口径不一致**
   - 对策：统计面板直接消费统一统计服务输出
